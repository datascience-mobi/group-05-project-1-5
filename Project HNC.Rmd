---
title: "Project Head and Neck Cancer"
author: "Nils Mechtel, Tobias Hub, Niklas Urbanek, Pascal Poc"
date: "6 Mai 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Data Cleanup & Descriptive Statistics

## Load data and define HNC variables
```{r}
### Load dataset
allDepMapData = readRDS("DepMap19Q1_allData.RDS")

### Creation of sub matrices
expression = allDepMapData[["expression"]]
copynumber = allDepMapData[["copynumber"]]
mutation = allDepMapData[["mutation"]]
kd.ceres = allDepMapData[["kd.ceres"]]
kd.prob = allDepMapData[["kd.prob"]]
annotation = allDepMapData[["annotation"]]

### Reducing the samples to head and neck cancer samples
annotation.HNC = annotation[which(annotation$Primary.Disease == "Head and Neck Cancer"), ]
ID = annotation.HNC$DepMap_ID

### Filtering of sub matrices by primary disease "Head and neck cancer"
expression.HNC = expression[ , which(colnames(expression) %in% ID)]
copynumber.HNC = copynumber[ , which(colnames(copynumber) %in% ID)]
kd.ceres.HNC = kd.ceres[ , which(colnames(kd.ceres) %in% ID)]
kd.prob.HNC = kd.prob[ , which(colnames(kd.prob) %in% ID)]
mutation.HNC = mutation[ID]
```

## Expression analysis

### Compare the mean gene expression of all samples with just HNC samples
```{r}
mean.exp.all = apply(expression, 1, mean)
 
mean.exp.HNC = apply(expression.HNC, 1, mean)

t.test(mean.exp.all, mean.exp.HNC, paired = TRUE)

rm(mean.exp.HNC)

```
Result: Mean gene expression differs between HNC samples and all samples significantly.

### Compare mean TP53 gene expression of all samples with and without deleterious TP53 mutation
```{r}
mutation.all = do.call(rbind, mutation)

TP53.mut.ID = mutation.all[which(mutation.all$Hugo_Symbol == "TP53" & mutation.all$isDeleterious == TRUE), ]$DepMap_ID
TP53.norm.ID = annotation$DepMap_ID[-which(annotation$DepMap_ID %in% TP53.mut.ID)]

t.test(expression["TP53", TP53.mut.ID], expression["TP53", TP53.norm.ID])

rm(TP53.mut.ID, TP53.norm.ID)
```
Result: Gene expression of varies significantly whether the samples has or has no a deleterious TP53 mutation.

### Plot some genes
```{r}
sample1 = data.frame(Genes=rownames(expression.HNC),Values=expression.HNC$`ACH-000188`)
sample1$Group<-ifelse(sample1$Values>2,"A","B")
sample1 = sample1[1:30,] 
ggplot(sample1,aes(x=Genes,y=Values,fill=Group))+geom_bar(stat="identity")+coord_flip()
rm(sample1)
```
### Plot the 25 most under- and overexpressed genes
```{r}
expr.norm = apply(expression.HNC, 2, function(x) {
    x - mean.exp.all
})
expr.norm = as.data.frame(expr.norm)
sample1.n = data.frame(Genes=rownames(expr.norm),Values=expr.norm$`ACH-000188`)
sample1.n$Group<-ifelse(sample1.n$Values>0,"overexpressed","underexpressed")
l = quantile(expr.norm$`ACH-000188`, probs = seq(0, 1, 0.0005))[2]
h = quantile(expr.norm$`ACH-000188`, probs = seq(0, 1, 0.0005))[2000]
sample1.n = sample1.n[which(sample1.n$Values < l | sample1.n$Values > h),] 
ggplot(sample1.n,aes(x=Genes,y=Values,fill=Group))+geom_bar(stat="identity")+coord_flip()
rm(sample1.n, l, h)
```

## Copynumber Alteration

## Mutation

## Knockdown

# 2. Identify genes of interest

# 3. Find SL/SDL partner

# 4. Mutation prediction
